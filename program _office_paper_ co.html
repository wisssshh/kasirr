<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OFFICE & PAPER Co.</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <style>
        @media print {
    body * {
        visibility: hidden;
    }

    #receipt, #receipt * {
        visibility: visible;
    }

    #receipt-content {
        position: absolute;
        left: 0;
        top: 0;
        width: 80mm; /* Ubah ke 58mm atau 80mm sesuai kebutuhan */
        padding: 5px;
        font-family: monospace;
        font-size: 10px;
        line-height: 1.2;
    }

    @page {
        margin: 0;
        size: 80mm auto;
    }

    #receipt button {
        display: none;
    }
}

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f9;
        }
        .container {
            max-width: 1200px;
            margin: 10px auto;
        }
        .product-list, .cart {
            margin-bottom: 20px;
        }
        .product-item {
            padding: 10px;
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin-bottom: 10px;
        }
        .product-item h5 {
            margin: 0;
            font-size: 16px;
        }
        .product-item p {
            margin: 5px 0;
            font-size: 14px;
        }
        .product-item button {
            width: 100%;
        }
        .product-item img {
            max-height: 150px;
            object-fit: contain;
            display: block;
            margin: 0 auto 10px;
        }
        .cart-table th, .cart-table td {
            text-align: center;
        }
        .total {
            font-size: 18px;
            font-weight: bold;
        }

    </style>
</head>
<body>

<div class="container">
    <h1 class="text-center my-4 fw-bold" style="font-weight:  900; color: #2ae327;">OFFICE & PAPER Co.</h1>
    <h6 class="text-center" style="line-height: 1.3;">Jl. Dokter Wahidin, Binjai Timur</h6>
    <h6 class="text-center" style="line-height: 1.3;">Telp: (061) 123-456789</h6>
    <h6 class="text-center" style="line-height: 1.3;">NPWP: 12.345.678.9-123.000</h6>
</div>
    <!-- Daftar Produk -->
        <div class="row product-list">
                <div class="col-md-4 product-item">
                    <img src="pensil2b.jpg" class="img-fluid mb-2" alt="Pensil 2B">
                    <h5>Pensil 2B</h5>
                    <p>Harga: Rp 2.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Pensil 2B" data-price="2000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="FaberCastel.jpg" class="img-fluid mb-2" alt="Pensil Faber Castell">
                    <h5>Pensil Faber Castell</h5>
                    <p>Harga: Rp 4.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Pensil Faber Castell" data-price="4000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="pulpenkenko.jpg" class="img-fluid mb-2" alt="Pulpen Kenko">
                    <h5>Pulpen Kenko</h5>
                    <p>Harga: Rp 5.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Pulpen Kenko" data-price="5000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="pulpenstandart.jpg" class="img-fluid mb-2" alt="Pulpen Standart">
                    <h5>Pulpen Standart</h5>
                    <p>Harga: Rp 1.500</p>
                    <button class="btn btn-primary add-to-cart" data-name="Pulpen Standart" data-price="1500">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="penghapus.jpg" class="img-fluid mb-2" alt="Penghapus Pensil">
                    <h5>Penghapus Pensil</h5>
                    <p>Harga: Rp 1.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Penghapus Pensil" data-price="1000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="bukunota.jpg" class="img-fluid mb-2" alt="Buku Nota">
                    <h5>Buku Nota</h5>
                    <p>Harga: Rp 4.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Buku Nota" data-price="4000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="bukubigboss.jpg" class="img-fluid mb-2" alt="Buku Big Boss">
                    <h5>Buku Big Boss</h5>
                    <p>Harga: Rp 6.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Buku Big Boss" data-price="6000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="stickynotes.jpg" class="img-fluid mb-2" alt="Sticky Notes">
                    <h5>Sticky Notes</h5>
                    <p>Harga: Rp 3.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Sticky Notes" data-price="3000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="staples.jpg" class="img-fluid mb-2" alt="Staples">
                    <h5>Staples</h5>
                    <p>Harga: Rp 3.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Staples" data-price="3000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="stapler.jpg" class="img-fluid mb-2" alt="Stapler">
                    <h5>Stapler</h5>
                    <p>Harga: Rp 12.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Stapler" data-price="12000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="doublefolio.jpg" class="img-fluid mb-2" alt="Kertas Double Folio 100 lembar">
                    <h5>Kertas Double Folio 100 lembar</h5>
                    <p>Harga: Rp 25.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Kertas Double Folio 100 lembar" data-price="25000">Tambah ke Keranjang</button>
                </div>
                <div class="col-md-4 product-item">
                    <img src="hvs a4.jpg" class="img-fluid mb-2" alt="Kertas A4 1 Rim">
                    <h5>Kertas A4 1 Rim</h5>
                    <p>Harga: Rp 47.000</p>
                    <button class="btn btn-primary add-to-cart" data-name="Kertas A4 1 Rim" data-price="47000">Tambah ke Keranjang</button>
                </div>
       
    <!-- Keranjang Belanja -->
    <div class="cart">
        <h3>Keranjang Belanja</h3>
        <table class="table cart-table">
            <thead>
                <tr>
                    <th>Nama Barang</th>
                    <th>Harga</th>
                    <th>Jumlah</th>
                    <th>Subtotal</th>
                    <th>Aksi</th>
                </tr>
            </thead>
            <tbody id="cart-items">
                <!-- Item keranjang akan ditambahkan di sini -->
            </tbody>
        </table>
        <p class="total">Total: Rp 0</p>
        <button class="btn btn-success w-100" id="checkout-btn">Proses Pembayaran</button>
    </div>

    <!-- Struk Pembelian -->
    <div id="receipt" style="display: none; background: #fff; padding: 20px; border: 1px solid #ccc; margin-top: 20px;">
    <h4>Struk Pembelian</h4>
    <div id="receipt-content"></div>
    <button class="btn btn-secondary mt-3" onclick="window.print()">Cetak Struk</button>
    <button class="btn btn-secondary mt-2" onclick="window.savePDF80mm()">Simpan sebagai PDF</button>
</div>

    </div>
</div>


<script>
    async function savePDF80mm() {
    const receiptElement = document.getElementById("receipt-content");

    const canvas = await html2canvas(receiptElement, {
        scale: 2,
        useCORS: true
    });

    const imgData = canvas.toDataURL("image/png");

    // Ukuran: 80mm x auto -> dalam satuan jsPDF: mm
    const pdf = new jspdf.jsPDF({
        orientation: "portrait",
        unit: "mm",
        format: [80, canvas.height * (80 / canvas.width)]
    });

    pdf.addImage(imgData, "PNG", 0, 0, 80, canvas.height * (80 / canvas.width));

    const timestamp = new Date().toISOString().replace(/[:.]/g, "-");
    pdf.save(`struk-80mm-${timestamp}.pdf`);
}


    async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const receiptContent = document.getElementById('receipt-content').innerText;

    // Atur margin & font agar rapi
    doc.setFont("Courier", "normal");
    doc.setFontSize(10);
    doc.text(receiptContent, 10, 10);

    doc.save('struk-pembelian.pdf');
}

    const cart = [];

    function formatRupiah(angka) {
        return angka.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
    }

    // Tambah ke keranjang
    document.querySelectorAll('.add-to-cart').forEach(button => {
        button.addEventListener('click', () => {
            const name = button.getAttribute('data-name');
            const price = parseInt(button.getAttribute('data-price'));
            const existingItem = cart.find(item => item.name === name);

            if (existingItem) {
                existingItem.quantity += 1;
                existingItem.subtotal = existingItem.quantity * price;
            } else {
                cart.push({ name, price, quantity: 1, subtotal: price });
            }

            updateCart();
        });
    });

    function removeItem(name) {
        const index = cart.findIndex(item => item.name === name);
        if (index !== -1) {
            cart.splice(index, 1);
            updateCart();
        }
    }

    function updateCart() {
        const cartItemsContainer = document.getElementById('cart-items');
        cartItemsContainer.innerHTML = '';

        let total = 0;
        cart.forEach(item => {
            total += item.subtotal;
            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${item.name}</td>
                <td>Rp ${formatRupiah(item.price)}</td>
                <td>${item.quantity}</td>
                <td>Rp ${formatRupiah(item.subtotal)}</td>
                <td><button class="btn btn-danger" onclick="removeItem('${item.name}')">Hapus</button></td>

            `;
            cartItemsContainer.appendChild(row);
        });

        document.querySelector('.total').textContent = `Total: Rp ${formatRupiah(total)}`;
    }

   function showReceipt(total, diskon, bayar, kembalian)
 {
    const receiptDiv = document.getElementById('receipt');
    const receiptContent = document.getElementById('receipt-content');
    const now = new Date();

    let html = `
        <div style="font-family: monospace; font-size: 10px; line-height 1.2;">
        <!-- Logo dan Info Toko -->
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom: 5px;">
            <img src="logotoko.jpg" alt="Logo" style="width: 60px; height: auto;">
            <div>
                <strong>OFFICE & PAPER Co.</strong><br>
                Jl. Dokter Wahidin, Binjai Timur<br>
                Telp: (061) 123-456789<br>
                NPWP: 12.345.678.9-123.000
            </div>
        </div>
        <pre style="margin: 0;">
======================================================
Tanggal : ${now.toLocaleDateString()} ${now.toLocaleTimeString()}
Kasir   : Amalya Chintya Putri
------------------------------------------------------
Nama Barang          Qty   Harga   Subtotal
------------------------------------------------------`;

    cart.forEach(item => {
        const name = item.name.padEnd(20).substring(0, 20);
        const qty = item.quantity.toString().padStart(3);
        const price = formatRupiah(item.price).padStart(7);
        const subtotal = formatRupiah(item.subtotal).padStart(9);
        html += `\n${name} ${qty} ${price} ${subtotal}`;
    });

    html += `
------------------------------------------------------
TOTAL               : Rp. ${formatRupiah(total).padStart(10)}
DISKON              : Rp. ${formatRupiah(diskon).padStart(10)}
TOTAL BAYAR         : Rp. ${formatRupiah(total - diskon).padStart(10)}
TUNAI               : Rp. ${formatRupiah(bayar).padStart(10)}
KEMBALIAN           : Rp. ${formatRupiah(kembalian).padStart(10)}
------------------------------------------------------
             TERIMA KASIH TELAH             
            BERBELANJA DI TOKO KAMI         
======================================================
        </pre>`;

    receiptContent.innerHTML = html;
    receiptDiv.style.display = 'block';
}



    document.getElementById('checkout-btn').addEventListener('click', () => {
        if (cart.length === 0) {
            alert('Keranjang belanja kosong!');
            return;
        }

        let total = cart.reduce((sum, item) => sum + item.subtotal, 0);

// Hitung diskon
let diskon = 0;
if (total >= 100000) {
    diskon = total * 0.10;
} else if (total >= 50000) {
    diskon = total * 0.05;
}

let totalSetelahDiskon = total - diskon;

        const bayar = prompt(`Total belanja: Rp ${formatRupiah(total)}\nDiskon: Rp ${formatRupiah(diskon)}\nTotal Bayar: Rp ${formatRupiah(totalSetelahDiskon)}\nMasukkan jumlah uang:`);
        const uang = parseInt(bayar);

        if (isNaN(uang)) {
            alert('Masukan tidak valid!');
            return;
        }

        const kembalian = uang - totalSetelahDiskon;
        if (kembalian >= 0) {
            alert(`Pembayaran berhasil!\nKembalian: Rp ${formatRupiah(kembalian)}`);
            showReceipt(total, diskon, uang, kembalian);
            cart.length = 0;
            updateCart();
        } else {
            alert('Uang tidak cukup!');
        }
    });
</script>

</body>
</html>
